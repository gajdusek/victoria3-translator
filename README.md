# Victoria 3 Localization Generator

This repository contains a simple script for generating localization files for Victoria 3 using GPT-4o-mini. Initially developed for Czech localization, it can be used for other languages by specifying the desired target language.

## Installation and Setup

### Create a Virtual Environment

```sh
python3 -m venv venv
```

### Activate the Virtual Environment

On Linux/macOS:

```sh
source venv/bin/activate
```

On Windows:

```sh
venv\Scripts\activate
```

### Install Dependencies

```sh
pip install -r requirements.txt
```

## Generating the Localization

Run the script to generate the localization files:

```sh
export OPENAI_API_KEY=your_openai_api_key
python3 generate-victoria3-l10n.py --input-game-dir /path/to/game/game --output-dir /path/to/mod --language czech
```

- `--input-game-dir` should point to the `game/` directory within the Victoria 3 installation.
- `--output-dir` is the directory where the generated localization files will be stored.
- `--language` should be set to the desired target language (e.g., `czech`).

The path to the game directory is the `game/` within the Victoria 3 installation directory. If you use Steam you can
find it by right clicking on Victoria 3 in the Steam library, selecting Manage-> Browse local files.

This script verifies the validity of the resulting YAML files. However, since even the original Paradox YAML files are often not valid, this is not a foolproof check. You should always review at least the files that failed validation.

To capture and inspect errors, run:

```sh
python -u generate-victoria3-l10n.py .... 2>&1 | tee generate-victoria3-l10n.log
```

Then, search for errors in the log file:

```sh
grep 'Error' generate-victoria3-l10n.log
```

Example error:

```
Translating file: orig/game/localization/jomini/script_system/trigger_system_l_english.yml
  Translating chunk 1/1 (approx 146 tokens)...
Adding BOM to: build/localization/jomini/script_system/trigger_system_l_czech.yml
Saved translated file to: build/localization/jomini/script_system/trigger_system_l_czech.yml
Error: The file 'build/localization/jomini/script_system/trigger_system_l_czech.yml' is not a valid YAML file: while parsing a block mapping
  in "build/localization/jomini/script_system/trigger_system_l_czech.yml", line 1, column 1
expected <block end>, but found '<scalar>'
  in "build/localization/jomini/script_system/trigger_system_l_czech.yml", line 9, column 3
```

## Creating and Installing the Mod

1. Copy `localization/languages.yml` from the game directory into your generated mod's `localization/` folder and manually add the new language.
2. Ensure all YAML files have a UTF-8 BOM, as required by the Clausewitz engine. The script automatically adds it via `add_bom.py`, but you can also run:
   ```sh
   python3 add_bom.py /path/to/mod/localization
   ```
3. Add a `.metadata/metadata.json` file inside the mod directory. Example (update as needed, especially the `supported_game_version`):
   ```json
   {
       "name": "Czech Localization",
       "id": "com.github.gajdusek.victoria3-czech-l10n",
       "version": "0.1",
       "game_id": "victoria3",
       "supported_game_version": "1.8.6",
       "short_description": "Czech localization generated by gpt-4o-mini",
       "tags": ["localization", "czech"],
       "relationships": [],
       "game_custom_data": {
           "multiplayer_synchronized": true
       }
   }
   ```

## Setting the Language in the Game

Paradox Launcher does not recognize newly added languages and resets the language setting in `pdx_settings.json`, even if you change it in-game. To prevent this:

1. Edit `pdx_settings.json` manually to set:
   ```json
   "language": "l_czech"
   ```
   - On Linux: `~/.paradoxinteractive/launcher-v2/pdx_settings.json`
   - On Windows: `C:\Users\YourUser\AppData\Roaming\Paradox Interactive\launcher-v2\pdx_settings.json`
2. Set the file to read-only to prevent the launcher from overwriting it.

## Disclaimer

This is a very simple script, rather a proof of concept (PoC), but functional.
